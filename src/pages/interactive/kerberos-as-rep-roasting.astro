---
// This is an Astro component that renders the AS-REP Roasting interactive page
---

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Anatomy of an AS-REP Roasting Attack</title>
    <link rel="stylesheet" href="/interactive/as-rep-styles.css">
    <meta name="robots" content="index,follow">
</head>
<body class="antialiased">
    <!-- Main content container with padding and a max-width for readability -->
    <header class="bg-white shadow-sm sticky top-0 z-50">
        <nav class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center">
                    <span class="text-2xl font-bold text-blue-600">CyberSec Deep Dive</span>
                </div>
                <div class="hidden md:block">
                    <div class="ml-10 flex items-baseline space-x-4">
                        <a href="#introduction" class="text-gray-500 hover:text-blue-600 px-3 py-2 rounded-md text-sm font-medium">Introduction</a>
                        <a href="#kerberos-flow" class="text-gray-500 hover:text-blue-600 px-3 py-2 rounded-md text-sm font-medium">Kerberos Flow</a>
                        <a href="#attack-chain" class="text-gray-500 hover:text-blue-600 px-3 py-2 rounded-md text-sm font-medium">Attack Chain</a>
                        <a href="#malware-analysis" class="text-gray-500 hover:text-blue-600 px-3 py-2 rounded-md text-sm font-medium">Malware Analysis</a>
                        <a href="#mitigation" class="text-gray-500 hover:text-blue-600 px-3 py-2 rounded-md text-sm font-medium">Mitigation</a>
                    </div>
                </div>
            </div>
        </nav>
    </header>

    <main class="container mx-auto px-4 sm:px-6 lg:px-8 py-8 md:py-12">
        <section id="introduction" class="text-center mb-16 md:mb-24">
            <h1 class="text-4xl md:text-5xl font-extrabold tracking-tight text-slate-900 mb-4">The Anatomy of an AS-REP Roasting Attack</h1>
            <p class="max-w-3xl mx-auto text-lg text-slate-600">
                An interactive exploration of a common Active Directory attack. We'll dissect how a simple Kerberos misconfiguration can be exploited by attackers to compromise user credentials offline, and what technical artifacts this attack leaves behind.
            </p>
        </section>

        <section id="kerberos-flow" class="mb-16 md:mb-24">
            <div class="text-center mb-12">
                <h2 class="text-3xl font-bold text-slate-900">Understanding the Kerberos Authentication Service</h2>
                <p class="mt-2 text-lg text-slate-600 max-w-2xl mx-auto">
                    Before we dive into the attack, let's understand the normal, secure process. The first step in Kerberos is the Authentication Service (AS) exchange, where a client proves its identity to get a master ticket, called a Ticket-Granting Ticket (TGT). This process relies on a key security feature: Pre-Authentication.
                </p>
            </div>
            
            <div class="bg-white p-6 md:p-8 rounded-xl shadow-lg border border-slate-200">
                <div class="flex items-center justify-center mb-6 space-x-4">
                    <button id="secure-flow-btn" class="px-6 py-2 rounded-full font-medium text-white bg-blue-600 hover:bg-blue-700 transition">Secure Flow</button>
                    <button id="vulnerable-flow-btn" class="px-6 py-2 rounded-full font-medium text-gray-700 bg-gray-200 hover:bg-gray-300 transition">Vulnerable Flow</button>
                </div>
                
                <div id="kerberos-diagram" class="relative flex flex-col md:flex-row items-center justify-around space-y-8 md:space-y-0 md:space-x-8 h-48 md:h-32">
                    <div class="text-center w-full md:w-1/4">
                        <div class="p-4 bg-slate-100 rounded-lg shadow-inner">
                            <h3 class="font-bold text-lg">üë§ Client</h3>
                            <p class="text-sm text-slate-600">Wants to access resources.</p>
                        </div>
                    </div>
                    
                    <div class="relative w-full md:w-1/3">
                        <div id="as-req-line" class="flow-line absolute top-1/2 -translate-y-1/2 left-0 w-0 h-1 bg-gray-400 rounded-full md:left-auto md:w-full md:h-1 md:bg-gray-400"></div>
                        <div id="as-req-box" class="flow-box absolute top-1/2 -translate-y-1/2 left-0 w-20 h-8 bg-blue-500 rounded-md shadow flex items-center justify-center text-white text-xs font-semibold opacity-0 md:left-1/2 md:-translate-x-1/2 md:w-20 md:h-8">AS-REQ</div>
                        <div id="pre-auth-status" class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 mt-10 md:mt-0 text-sm font-semibold p-1 px-2 rounded-full text-white"></div>
                    </div>
                    
                    <div class="text-center w-full md:w-1/4">
                        <div class="p-4 bg-slate-100 rounded-lg shadow-inner">
                            <h3 class="font-bold text-lg">üîë KDC</h3>
                            <p class="text-sm text-slate-600">Authenticates users.</p>
                        </div>
                    </div>

                    <div class="relative w-full md:w-1/3">
                        <div id="as-rep-line" class="flow-line absolute top-1/2 -translate-y-1/2 left-0 w-0 h-1 bg-gray-400 rounded-full md:left-auto md:w-full md:h-1 md:bg-gray-400"></div>
                        <div id="as-rep-box" class="flow-box absolute top-1/2 -translate-y-1/2 left-0 w-20 h-8 bg-yellow-500 rounded-md shadow flex items-center justify-center text-white text-xs font-semibold opacity-0 md:left-1/2 md:-translate-x-1/2 md:w-20 md:h-8">AS-REP</div>
                    </div>
                    
                    <div class="text-center w-full md:w-1/4">
                       <div class="p-4 bg-slate-100 rounded-lg shadow-inner">
                            <h3 class="font-bold text-lg">üéüÔ∏è Encrypted TGT</h3>
                            <p class="text-sm text-slate-600">Proof of identity.</p>
                        </div>
                    </div>
                </div>
                
                <div id="explanation-box" class="mt-8 p-6 bg-blue-50 border-l-4 border-blue-500 rounded-r-lg">
                    <h4 class="font-bold text-lg text-blue-800 mb-2">Flow Explanation</h4>
                    <p id="flow-explanation-text" class="text-blue-700">Select an option above to see how the Kerberos AS process works, both in a secure and vulnerable state.</p>
                </div>
            </div>
        </section>

        <section id="attack-chain" class="mb-16 md:mb-24">
            <div class="text-center mb-12">
                <h2 class="text-3xl font-bold text-slate-900">The AS-REP Roasting Attack Chain</h2>
                <p class="mt-2 text-lg text-slate-600 max-w-2xl mx-auto">
                    When Pre-Authentication is disabled for a user account, an attacker can exploit this misconfiguration. The KDC no longer validates the requester's identity, creating a critical vulnerability. Let's walk through the attack step by step.
                </p>
            </div>
            
            <div class="lg:grid lg:grid-cols-3 lg:gap-8 items-start">
                <div class="lg:col-span-1">
                    <div class="sticky top-24">
                        <h3 id="step-title" class="text-xl font-bold text-slate-800 mb-4">Click "Start" to begin the walkthrough.</h3>
                        <p id="step-text" class="mt-2 text-slate-600">Use the navigation buttons below to guide yourself through each stage of the attack chain.</p>
                        <div class="mt-6 flex space-x-4">
                            <button id="prev-step-btn" class="px-6 py-2 rounded-full bg-gray-200 text-gray-700 font-medium transition" disabled>&lt; Previous</button>
                            <button id="next-step-btn" class="px-6 py-2 rounded-full bg-blue-600 text-white font-medium transition">Start</button>
                        </div>
                        <pre id="step-code" class="mt-4 bg-slate-800 text-slate-200 p-4 rounded-lg text-sm overflow-x-auto hidden"></pre>
                    </div>
                </div>

                <div class="lg:col-span-2 mt-10 lg:mt-0">
                    <div class="space-y-4">
                        <div id="step-1-box" class="step-box bg-white p-6 rounded-lg border-2 border-transparent transition-all duration-300 ease-in-out cursor-pointer" data-api="LsaConnectUntrusted">
                            <p class="font-bold">1. Discovery: Find users with pre-auth disabled.</p>
                        </div>
                        <div id="step-2-box" class="step-box bg-white p-6 rounded-lg border-2 border-transparent transition-all duration-300 ease-in-out cursor-pointer" data-api="InitializeSecurityContext">
                            <p class="font-bold">2. Request: Attacker sends AS-REQ for the vulnerable user.</p>
                        </div>
                        <div id="step-3-box" class="step-box bg-white p-6 rounded-lg border-2 border-transparent transition-all duration-300 ease-in-out cursor-pointer" data-api="AcquireCredentialsHandle">
                            <p class="font-bold">3. Response: KDC returns AS-REP with encrypted TGT portion.</p>
                        </div>
                        <div id="step-4-box" class="step-box bg-white p-6 rounded-lg border-2 border-transparent transition-all duration-300 ease-in-out cursor-pointer" data-api="">
                            <p class="font-bold">4. Crack: Attacker brute-forces the hash offline to get the password.</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="malware-analysis" class="mb-16 md:mb-24">
            <div class="text-center mb-12">
                <h2 class="text-3xl font-bold text-slate-900">Malware Analyst's Perspective</h2>
                <p class="mt-2 text-lg text-slate-600 max-w-2xl mx-auto">
                    From a malware analysis viewpoint, specific patterns emerge when a binary performs this attack programmatically. Click on the API calls below to see more details on how the attack is performed.
                </p>
            </div>

            <div class="grid md:grid-cols-2 gap-8">
                <div class="bg-white p-6 md:p-8 rounded-xl shadow-lg border border-slate-200">
                    <h3 class="text-xl font-bold text-slate-800 mb-4">Key Windows API Calls</h3>
                    <ul class="space-y-3">
                        <li><a href="#" class="api-call-link block bg-slate-100 text-slate-800 p-2 rounded hover:bg-slate-200 transition" data-step="3"><code>AcquireCredentialsHandle</code></a></li>
                        <li><a href="#" class="api-call-link block bg-slate-100 text-slate-800 p-2 rounded hover:bg-slate-200 transition" data-step="2"><code>InitializeSecurityContext</code></a></li>
                        <li><a href="#" class="api-call-link block bg-slate-100 text-slate-800 p-2 rounded hover:bg-slate-200 transition" data-step="1"><code>LsaConnectUntrusted</code> / <code>LsaCallAuthenticationPackage</code></a></li>
                    </ul>
                </div>
                <div id="api-detail-panel" class="bg-white p-6 md:p-8 rounded-xl shadow-lg border border-slate-200 hidden">
                    <h3 id="api-title" class="text-xl font-bold text-slate-800 mb-2"></h3>
                    <p id="api-description" class="text-slate-600 mb-4"></p>
                    <pre id="api-code" class="bg-slate-800 text-slate-200 p-4 rounded-lg text-sm overflow-x-auto"></pre>
                </div>
            </div>
        </section>

        <section id="captured-hash" class="mb-16 md:mb-24">
             <div class="text-center mb-12">
                <h2 class="text-3xl font-bold text-slate-900">The Captured AS-REP Hash</h2>
                <p class="mt-2 text-lg text-slate-600 max-w-2xl mx-auto">
                    The ultimate goal of the attack is to obtain this piece of data, which can then be cracked offline to reveal the user's password. This is what the captured hash actually looks like:
                </p>
            </div>
            <div class="bg-white p-6 md:p-8 rounded-xl shadow-lg border border-slate-200">
                <pre class="bg-gray-800 text-green-400 p-4 rounded-lg overflow-x-auto whitespace-pre-wrap break-all text-sm">
$krb5asrep$23$USERACCOUNT@DOMAIN.COM:34524c96...
</pre>
                 <div class="mt-4 text-center">
                    
                 </div>
                 <p class="mt-6 text-slate-600">The AS-REP hash is a combination of the user's details and the encrypted TGT portion. The attacker uses specialized cracking tools like <strong>hashcat</strong> or <strong>john</strong> to run a wordlist attack against this hash until a match is found, revealing the plaintext password.</p>
            </div>
        </section>


        <section id="mitigation" class="bg-white p-8 rounded-xl shadow-lg border border-slate-200">
            <div class="text-center mb-8">
                <h2 class="text-3xl font-bold text-slate-900">Detection & Mitigation</h2>
                <p class="mt-2 text-lg text-slate-600 max-w-2xl mx-auto">
                    Protecting against AS-REP Roasting involves both proactive configuration and active monitoring.
                </p>
            </div>
            <div class="grid md:grid-cols-2 gap-8">
                <div>
                    <h3 class="font-bold text-xl text-slate-800 flex items-center mb-3">
                        <span class="text-green-500 mr-2">‚úîÔ∏è</span>
                        Proactive Mitigation
                    </h3>
                    <ul class="list-disc list-inside space-y-2 text-slate-600">
                        <li><strong>Enable Pre-Authentication:</strong> This is the primary defense. Audit your Active Directory for any user or service accounts that have 'Do not require Kerberos preauthentication' enabled and disable it unless absolutely necessary.</li>
                        <li><strong>Strong Passwords:</strong> Enforce strong, complex, and long password policies. This makes the offline cracking step significantly more difficult and time-consuming for an attacker.</li>
                        <li><strong>Limit Privileged Accounts:</strong> Ensure that highly privileged accounts (like Domain Admins) never have pre-authentication disabled.</li>
                    </ul>
                </div>
                 <div>
                    <h3 class="font-bold text-xl text-slate-800 flex items-center mb-3">
                        <span class="text-yellow-500 mr-2">üì°</span>
                        Active Detection
                    </h3>
                    <ul class="list-disc list-inside space-y-2 text-slate-600">
                        <li><strong>Monitor Event Logs:</strong> Look for Kerberos event ID 4768 on your Domain Controllers. A large number of these events for accounts without pre-authentication can indicate an attack.</li>
                        <li><strong>Network Traffic Analysis:</strong> Monitor for unusual patterns of AS-REQ traffic to your KDCs, especially from non-standard workstations.</li>
                         <li><strong>Honey Accounts:</strong> Create tempting "honey" user accounts with pre-authentication disabled and monitor them for any authentication attempts. Any activity on these accounts is a strong indicator of malicious discovery.</li>
                    </ul>
                </div>
            </div>
        </section>
    </main>

    <footer class="bg-slate-800 text-slate-400 mt-16">
        <div class="container mx-auto py-6 px-4 sm:px-6 lg:px-8 text-center">
            <p>&copy; 2025 CyberSec Deep Dive. An interactive learning experience.</p>
        </div>
    </footer>

    <div id="message-box" class="hidden message-box p-4 rounded-lg shadow-xl text-white font-medium text-center"></div>

    <script src="/interactive/as-rep-script.js" is:inline></script>
</body>
</html>
